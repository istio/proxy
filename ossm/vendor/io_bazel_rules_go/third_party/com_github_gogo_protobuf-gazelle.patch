diff -urN a/codec/BUILD.bazel b/codec/BUILD.bazel
--- a/codec/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/codec/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "codec",
+    srcs = ["codec.go"],
+    importpath = "github.com/gogo/protobuf/codec",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":codec",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "codec_test",
+    srcs = ["codec_test.go"],
+    embed = [":codec"],
+    deps = ["//test"],
+)
diff -urN a/conformance/BUILD.bazel b/conformance/BUILD.bazel
--- a/conformance/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/conformance/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,19 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "conformance_lib",
+    srcs = ["conformance.go"],
+    importpath = "github.com/gogo/protobuf/conformance",
+    visibility = ["//visibility:private"],
+    deps = [
+        "//conformance/internal/conformance_proto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
+
+go_binary(
+    name = "conformance",
+    embed = [":conformance_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/conformance/internal/conformance_proto/BUILD.bazel b/conformance/internal/conformance_proto/BUILD.bazel
--- a/conformance/internal/conformance_proto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/conformance/internal/conformance_proto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,24 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["conformance.proto"],
+    visibility = ["//conformance:__subpackages__"],
+)
+
+go_library(
+    name = "conformance_proto",
+    srcs = ["conformance.pb.go"],
+    importpath = "github.com/gogo/protobuf/conformance/internal/conformance_proto",
+    visibility = ["//conformance:__subpackages__"],
+    deps = [
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":conformance_proto",
+    visibility = ["//conformance:__subpackages__"],
+)
diff -urN a/gogoproto/BUILD.bazel b/gogoproto/BUILD.bazel
--- a/gogoproto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/gogoproto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,28 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["gogo.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "gogoproto",
+    srcs = [
+        "doc.go",
+        "gogo.pb.go",
+        "helper.go",
+    ],
+    importpath = "github.com/gogo/protobuf/gogoproto",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":gogoproto",
+    visibility = ["//visibility:public"],
+)
diff -urN a/gogoreplace/BUILD.bazel b/gogoreplace/BUILD.bazel
--- a/gogoreplace/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/gogoreplace/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,14 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "gogoreplace_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/gogoreplace",
+    visibility = ["//visibility:private"],
+)
+
+go_binary(
+    name = "gogoreplace",
+    embed = [":gogoreplace_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/io/BUILD.bazel b/io/BUILD.bazel
--- a/io/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/io/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,33 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "io",
+    srcs = [
+        "full.go",
+        "io.go",
+        "uint32.go",
+        "varint.go",
+    ],
+    importpath = "github.com/gogo/protobuf/io",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":io",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "io_test",
+    srcs = [
+        "io_test.go",
+        "uint32_test.go",
+    ],
+    deps = [
+        ":io",
+        "//test",
+        "//test/example",
+    ],
+)
diff -urN a/jsonpb/BUILD.bazel b/jsonpb/BUILD.bazel
--- a/jsonpb/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/jsonpb/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,30 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "jsonpb",
+    srcs = ["jsonpb.go"],
+    importpath = "github.com/gogo/protobuf/jsonpb",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":jsonpb",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "jsonpb_test",
+    srcs = ["jsonpb_test.go"],
+    embed = [":jsonpb"],
+    deps = [
+        "//jsonpb/jsonpb_test_proto",
+        "//proto",
+        "//proto/proto3_proto",
+        "//types",
+    ],
+)
diff -urN a/jsonpb/jsonpb_test_proto/BUILD.bazel b/jsonpb/jsonpb_test_proto/BUILD.bazel
--- a/jsonpb/jsonpb_test_proto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/jsonpb/jsonpb_test_proto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "more_test_objects.proto",
+        "test_objects.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "jsonpb_test_proto",
+    srcs = [
+        "bytes.go",
+        "more_test_objects.pb.go",
+        "test_objects.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/jsonpb/jsonpb_test_proto",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":jsonpb_test_proto",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/compare/BUILD.bazel b/plugin/compare/BUILD.bazel
--- a/plugin/compare/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/compare/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "compare",
+    srcs = [
+        "compare.go",
+        "comparetest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/compare",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+        "//vanity",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":compare",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/defaultcheck/BUILD.bazel b/plugin/defaultcheck/BUILD.bazel
--- a/plugin/defaultcheck/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/defaultcheck/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "defaultcheck",
+    srcs = ["defaultcheck.go"],
+    importpath = "github.com/gogo/protobuf/plugin/defaultcheck",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":defaultcheck",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/description/BUILD.bazel b/plugin/description/BUILD.bazel
--- a/plugin/description/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/description/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,24 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "description",
+    srcs = [
+        "description.go",
+        "descriptiontest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/description",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":description",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/embedcheck/BUILD.bazel b/plugin/embedcheck/BUILD.bazel
--- a/plugin/embedcheck/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/embedcheck/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "embedcheck",
+    srcs = ["embedcheck.go"],
+    importpath = "github.com/gogo/protobuf/plugin/embedcheck",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":embedcheck",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/enumstringer/BUILD.bazel b/plugin/enumstringer/BUILD.bazel
--- a/plugin/enumstringer/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/enumstringer/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "enumstringer",
+    srcs = ["enumstringer.go"],
+    importpath = "github.com/gogo/protobuf/plugin/enumstringer",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":enumstringer",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/equal/BUILD.bazel b/plugin/equal/BUILD.bazel
--- a/plugin/equal/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/equal/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "equal",
+    srcs = [
+        "equal.go",
+        "equaltest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/equal",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+        "//vanity",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":equal",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/face/BUILD.bazel b/plugin/face/BUILD.bazel
--- a/plugin/face/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/face/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "face",
+    srcs = [
+        "face.go",
+        "facetest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/face",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":face",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/gostring/BUILD.bazel b/plugin/gostring/BUILD.bazel
--- a/plugin/gostring/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/gostring/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "gostring",
+    srcs = [
+        "gostring.go",
+        "gostringtest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/gostring",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":gostring",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/marshalto/BUILD.bazel b/plugin/marshalto/BUILD.bazel
--- a/plugin/marshalto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/marshalto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "marshalto",
+    srcs = ["marshalto.go"],
+    importpath = "github.com/gogo/protobuf/plugin/marshalto",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+        "//vanity",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshalto",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/oneofcheck/BUILD.bazel b/plugin/oneofcheck/BUILD.bazel
--- a/plugin/oneofcheck/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/oneofcheck/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "oneofcheck",
+    srcs = ["oneofcheck.go"],
+    importpath = "github.com/gogo/protobuf/plugin/oneofcheck",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":oneofcheck",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/populate/BUILD.bazel b/plugin/populate/BUILD.bazel
--- a/plugin/populate/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/populate/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "populate",
+    srcs = ["populate.go"],
+    importpath = "github.com/gogo/protobuf/plugin/populate",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+        "//vanity",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":populate",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/size/BUILD.bazel b/plugin/size/BUILD.bazel
--- a/plugin/size/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/size/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "size",
+    srcs = [
+        "size.go",
+        "sizetest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/size",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+        "//vanity",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":size",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/stringer/BUILD.bazel b/plugin/stringer/BUILD.bazel
--- a/plugin/stringer/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/stringer/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "stringer",
+    srcs = [
+        "stringer.go",
+        "stringertest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/stringer",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":stringer",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/testgen/BUILD.bazel b/plugin/testgen/BUILD.bazel
--- a/plugin/testgen/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/testgen/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "testgen",
+    srcs = ["testgen.go"],
+    importpath = "github.com/gogo/protobuf/plugin/testgen",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":testgen",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/union/BUILD.bazel b/plugin/union/BUILD.bazel
--- a/plugin/union/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/union/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "union",
+    srcs = [
+        "union.go",
+        "uniontest.go",
+    ],
+    importpath = "github.com/gogo/protobuf/plugin/union",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//plugin/testgen",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":union",
+    visibility = ["//visibility:public"],
+)
diff -urN a/plugin/unmarshal/BUILD.bazel b/plugin/unmarshal/BUILD.bazel
--- a/plugin/unmarshal/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/plugin/unmarshal/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,20 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "unmarshal",
+    srcs = ["unmarshal.go"],
+    importpath = "github.com/gogo/protobuf/plugin/unmarshal",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshal",
+    visibility = ["//visibility:public"],
+)
diff -urN a/proto/BUILD.bazel b/proto/BUILD.bazel
--- a/proto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/proto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,78 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "proto",
+    srcs = [
+        "clone.go",
+        "custom_gogo.go",
+        "decode.go",
+        "deprecated.go",
+        "discard.go",
+        "duration.go",
+        "duration_gogo.go",
+        "encode.go",
+        "encode_gogo.go",
+        "equal.go",
+        "extensions.go",
+        "extensions_gogo.go",
+        "lib.go",
+        "lib_gogo.go",
+        "message_set.go",
+        "pointer_reflect.go",
+        "pointer_reflect_gogo.go",
+        "pointer_unsafe.go",
+        "pointer_unsafe_gogo.go",
+        "properties.go",
+        "properties_gogo.go",
+        "skip_gogo.go",
+        "table_marshal.go",
+        "table_marshal_gogo.go",
+        "table_merge.go",
+        "table_unmarshal.go",
+        "table_unmarshal_gogo.go",
+        "text.go",
+        "text_gogo.go",
+        "text_parser.go",
+        "timestamp.go",
+        "timestamp_gogo.go",
+        "wrappers.go",
+        "wrappers_gogo.go",
+    ],
+    importpath = "github.com/gogo/protobuf/proto",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":proto",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "proto_test",
+    srcs = [
+        "all_test.go",
+        "any_test.go",
+        "clone_test.go",
+        "decode_test.go",
+        "discard_test.go",
+        "encode_test.go",
+        "equal_test.go",
+        "extensions_test.go",
+        "map_test.go",
+        "message_set_test.go",
+        "proto3_test.go",
+        "size2_test.go",
+        "size_test.go",
+        "text_parser_test.go",
+        "text_test.go",
+    ],
+    embed = [":proto"],
+    deps = [
+        "//jsonpb",
+        "//proto/proto3_proto",
+        "//proto/test_proto",
+        "//protoc-gen-gogo/descriptor",
+        "//types",
+    ],
+)
diff -urN a/proto/proto3_proto/BUILD.bazel b/proto/proto3_proto/BUILD.bazel
--- a/proto/proto3_proto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/proto/proto3_proto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto3.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "proto3_proto",
+    srcs = ["proto3.pb.go"],
+    importpath = "github.com/gogo/protobuf/proto/proto3_proto",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//proto/test_proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":proto3_proto",
+    visibility = ["//visibility:public"],
+)
diff -urN a/proto/test_proto/BUILD.bazel b/proto/test_proto/BUILD.bazel
--- a/proto/test_proto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/proto/test_proto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["test.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "test_proto",
+    srcs = ["test.pb.go"],
+    importpath = "github.com/gogo/protobuf/proto/test_proto",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":test_proto",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protobuf/google/protobuf/BUILD.bazel b/protobuf/google/protobuf/BUILD.bazel
--- a/protobuf/google/protobuf/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protobuf/google/protobuf/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,17 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "any.proto",
+        "api.proto",
+        "descriptor.proto",
+        "duration.proto",
+        "empty.proto",
+        "field_mask.proto",
+        "source_context.proto",
+        "struct.proto",
+        "timestamp.proto",
+        "type.proto",
+        "wrappers.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protobuf/google/protobuf/compiler/BUILD.bazel b/protobuf/google/protobuf/compiler/BUILD.bazel
--- a/protobuf/google/protobuf/compiler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protobuf/google/protobuf/compiler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,5 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["plugin.proto"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-combo/BUILD.bazel b/protoc-gen-combo/BUILD.bazel
--- a/protoc-gen-combo/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-combo/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,15 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-gen-combo_lib",
+    srcs = ["combo.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-combo",
+    visibility = ["//visibility:private"],
+    deps = ["//version"],
+)
+
+go_binary(
+    name = "protoc-gen-combo",
+    embed = [":protoc-gen-combo_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gofast/BUILD.bazel b/protoc-gen-gofast/BUILD.bazel
--- a/protoc-gen-gofast/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gofast/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-gen-gofast_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gofast",
+    visibility = ["//visibility:private"],
+    deps = [
+        "//vanity",
+        "//vanity/command",
+    ],
+)
+
+go_binary(
+    name = "protoc-gen-gofast",
+    embed = [":protoc-gen-gofast_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/BUILD.bazel b/protoc-gen-gogo/BUILD.bazel
--- a/protoc-gen-gogo/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library", "go_test")
+
+go_library(
+    name = "protoc-gen-gogo_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo",
+    visibility = ["//visibility:private"],
+    deps = ["//vanity/command"],
+)
+
+go_binary(
+    name = "protoc-gen-gogo",
+    embed = [":protoc-gen-gogo_lib"],
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "protoc-gen-gogo_test",
+    srcs = ["golden_test.go"],
+    embed = [":protoc-gen-gogo_lib"],
+)
diff -urN a/protoc-gen-gogo/descriptor/BUILD.bazel b/protoc-gen-gogo/descriptor/BUILD.bazel
--- a/protoc-gen-gogo/descriptor/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/descriptor/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,29 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "descriptor",
+    srcs = [
+        "descriptor.go",
+        "descriptor.pb.go",
+        "descriptor_gostring.gen.go",
+        "helper.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/descriptor",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":descriptor",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "descriptor_test",
+    srcs = ["descriptor_test.go"],
+    deps = [
+        ":descriptor",
+        "//proto/test_proto",
+    ],
+)
diff -urN a/protoc-gen-gogo/generator/BUILD.bazel b/protoc-gen-gogo/generator/BUILD.bazel
--- a/protoc-gen-gogo/generator/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/generator/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "generator",
+    srcs = [
+        "generator.go",
+        "helper.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/generator",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator/internal/remap",
+        "//protoc-gen-gogo/plugin",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":generator",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "generator_test",
+    srcs = ["name_test.go"],
+    embed = [":generator"],
+    deps = ["//protoc-gen-gogo/descriptor"],
+)
diff -urN a/protoc-gen-gogo/generator/internal/remap/BUILD.bazel b/protoc-gen-gogo/generator/internal/remap/BUILD.bazel
--- a/protoc-gen-gogo/generator/internal/remap/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/generator/internal/remap/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,20 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "remap",
+    srcs = ["remap.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/generator/internal/remap",
+    visibility = ["//protoc-gen-gogo/generator:__subpackages__"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":remap",
+    visibility = ["//protoc-gen-gogo/generator:__subpackages__"],
+)
+
+go_test(
+    name = "remap_test",
+    srcs = ["remap_test.go"],
+    embed = [":remap"],
+)
diff -urN a/protoc-gen-gogo/grpc/BUILD.bazel b/protoc-gen-gogo/grpc/BUILD.bazel
--- a/protoc-gen-gogo/grpc/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/grpc/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "grpc",
+    srcs = ["grpc.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/grpc",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//protoc-gen-gogo/descriptor",
+        "//protoc-gen-gogo/generator",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":grpc",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/plugin/BUILD.bazel b/protoc-gen-gogo/plugin/BUILD.bazel
--- a/protoc-gen-gogo/plugin/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/plugin/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "plugin",
+    srcs = ["plugin.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/plugin",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":plugin",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/BUILD.bazel b/protoc-gen-gogo/testdata/BUILD.bazel
--- a/protoc-gen-gogo/testdata/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,16 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_test")
+
+go_test(
+    name = "testdata_test",
+    srcs = [
+        "extension_test.go",
+        "main_test.go",
+    ],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/testdata/extension_base",
+        "//protoc-gen-gogo/testdata/extension_user",
+        "//protoc-gen-gogo/testdata/imports",
+        "//protoc-gen-gogo/testdata/my_test",
+    ],
+)
diff -urN a/protoc-gen-gogo/testdata/deprecated/BUILD.bazel b/protoc-gen-gogo/testdata/deprecated/BUILD.bazel
--- a/protoc-gen-gogo/testdata/deprecated/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/deprecated/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,26 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["deprecated.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "deprecated",
+    srcs = ["deprecated.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/deprecated",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "@org_golang_google_grpc//:go_default_library",
+        "@org_golang_google_grpc//codes:go_default_library",
+        "@org_golang_google_grpc//status:go_default_library",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":deprecated",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/extension_base/BUILD.bazel b/protoc-gen-gogo/testdata/extension_base/BUILD.bazel
--- a/protoc-gen-gogo/testdata/extension_base/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/extension_base/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["extension_base.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "extension_base",
+    srcs = ["extension_base.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/extension_base",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":extension_base",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/extension_extra/BUILD.bazel b/protoc-gen-gogo/testdata/extension_extra/BUILD.bazel
--- a/protoc-gen-gogo/testdata/extension_extra/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/extension_extra/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["extension_extra.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "extension_extra",
+    srcs = ["extension_extra.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/extension_extra",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":extension_extra",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/extension_user/BUILD.bazel b/protoc-gen-gogo/testdata/extension_user/BUILD.bazel
--- a/protoc-gen-gogo/testdata/extension_user/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/extension_user/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["extension_user.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "extension_user",
+    srcs = ["extension_user.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/extension_user",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/testdata/extension_base",
+        "//protoc-gen-gogo/testdata/extension_extra",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":extension_user",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/grpc/BUILD.bazel b/protoc-gen-gogo/testdata/grpc/BUILD.bazel
--- a/protoc-gen-gogo/testdata/grpc/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/grpc/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,32 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "grpc.proto",
+        "grpc_empty.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "grpc",
+    srcs = [
+        "grpc.pb.go",
+        "grpc_empty.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/grpc",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "@org_golang_google_grpc//:go_default_library",
+        "@org_golang_google_grpc//codes:go_default_library",
+        "@org_golang_google_grpc//status:go_default_library",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":grpc",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/import_public/BUILD.bazel b/protoc-gen-gogo/testdata/import_public/BUILD.bazel
--- a/protoc-gen-gogo/testdata/import_public/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/import_public/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,30 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "a.proto",
+        "b.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "import_public",
+    srcs = [
+        "a.pb.go",
+        "b.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/import_public",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/testdata/import_public/sub",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":import_public",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/import_public/importing/BUILD.bazel b/protoc-gen-gogo/testdata/import_public/importing/BUILD.bazel
--- a/protoc-gen-gogo/testdata/import_public/importing/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/import_public/importing/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["importing.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "importing",
+    srcs = ["importing.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/import_public/importing",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/testdata/import_public",
+        "//protoc-gen-gogo/testdata/import_public/sub",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":importing",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/import_public/sub/BUILD.bazel b/protoc-gen-gogo/testdata/import_public/sub/BUILD.bazel
--- a/protoc-gen-gogo/testdata/import_public/sub/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/import_public/sub/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,27 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "a.proto",
+        "b.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "sub",
+    srcs = [
+        "a.pb.go",
+        "b.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/import_public/sub",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":sub",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/imports/BUILD.bazel b/protoc-gen-gogo/testdata/imports/BUILD.bazel
--- a/protoc-gen-gogo/testdata/imports/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/imports/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "test_import_a1m1.proto",
+        "test_import_a1m2.proto",
+        "test_import_all.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "imports",
+    srcs = [
+        "test_import_a1m1.pb.go",
+        "test_import_a1m2.pb.go",
+        "test_import_all.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/imports",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/testdata/imports/fmt",
+        "//protoc-gen-gogo/testdata/imports/test_a_1",
+        "//protoc-gen-gogo/testdata/imports/test_a_2",
+        "//protoc-gen-gogo/testdata/imports/test_b_1",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":imports",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/imports/fmt/BUILD.bazel b/protoc-gen-gogo/testdata/imports/fmt/BUILD.bazel
--- a/protoc-gen-gogo/testdata/imports/fmt/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/imports/fmt/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["m.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "fmt",
+    srcs = ["m.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/imports/fmt",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":fmt",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/imports/test_a_1/BUILD.bazel b/protoc-gen-gogo/testdata/imports/test_a_1/BUILD.bazel
--- a/protoc-gen-gogo/testdata/imports/test_a_1/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/imports/test_a_1/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,27 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "m1.proto",
+        "m2.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "test_a_1",
+    srcs = [
+        "m1.pb.go",
+        "m2.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/imports/test_a_1",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":test_a_1",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/imports/test_a_2/BUILD.bazel b/protoc-gen-gogo/testdata/imports/test_a_2/BUILD.bazel
--- a/protoc-gen-gogo/testdata/imports/test_a_2/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/imports/test_a_2/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,27 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "m3.proto",
+        "m4.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "test_a_2",
+    srcs = [
+        "m3.pb.go",
+        "m4.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/imports/test_a_2",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":test_a_2",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/imports/test_b_1/BUILD.bazel b/protoc-gen-gogo/testdata/imports/test_b_1/BUILD.bazel
--- a/protoc-gen-gogo/testdata/imports/test_b_1/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/imports/test_b_1/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,27 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "m1.proto",
+        "m2.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "test_b_1",
+    srcs = [
+        "m1.pb.go",
+        "m2.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/imports/test_b_1",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":test_b_1",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/multi/BUILD.bazel b/protoc-gen-gogo/testdata/multi/BUILD.bazel
--- a/protoc-gen-gogo/testdata/multi/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/multi/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,9 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "multi1.proto",
+        "multi2.proto",
+        "multi3.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/my_test/BUILD.bazel b/protoc-gen-gogo/testdata/my_test/BUILD.bazel
--- a/protoc-gen-gogo/testdata/my_test/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/my_test/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["test.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "my_test",
+    srcs = ["test.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/my_test",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":my_test",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogo/testdata/proto3/BUILD.bazel b/protoc-gen-gogo/testdata/proto3/BUILD.bazel
--- a/protoc-gen-gogo/testdata/proto3/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogo/testdata/proto3/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto3.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "proto3",
+    srcs = ["proto3.pb.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogo/testdata/proto3",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":proto3",
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogofast/BUILD.bazel b/protoc-gen-gogofast/BUILD.bazel
--- a/protoc-gen-gogofast/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogofast/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-gen-gogofast_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogofast",
+    visibility = ["//visibility:private"],
+    deps = [
+        "//vanity",
+        "//vanity/command",
+    ],
+)
+
+go_binary(
+    name = "protoc-gen-gogofast",
+    embed = [":protoc-gen-gogofast_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogofaster/BUILD.bazel b/protoc-gen-gogofaster/BUILD.bazel
--- a/protoc-gen-gogofaster/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogofaster/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-gen-gogofaster_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogofaster",
+    visibility = ["//visibility:private"],
+    deps = [
+        "//vanity",
+        "//vanity/command",
+    ],
+)
+
+go_binary(
+    name = "protoc-gen-gogofaster",
+    embed = [":protoc-gen-gogofaster_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogoslick/BUILD.bazel b/protoc-gen-gogoslick/BUILD.bazel
--- a/protoc-gen-gogoslick/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogoslick/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-gen-gogoslick_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogoslick",
+    visibility = ["//visibility:private"],
+    deps = [
+        "//vanity",
+        "//vanity/command",
+    ],
+)
+
+go_binary(
+    name = "protoc-gen-gogoslick",
+    embed = [":protoc-gen-gogoslick_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gogotypes/BUILD.bazel b/protoc-gen-gogotypes/BUILD.bazel
--- a/protoc-gen-gogotypes/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gogotypes/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-gen-gogotypes_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gogotypes",
+    visibility = ["//visibility:private"],
+    deps = [
+        "//vanity",
+        "//vanity/command",
+    ],
+)
+
+go_binary(
+    name = "protoc-gen-gogotypes",
+    embed = [":protoc-gen-gogotypes_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-gen-gostring/BUILD.bazel b/protoc-gen-gostring/BUILD.bazel
--- a/protoc-gen-gostring/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-gen-gostring/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,18 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-gen-gostring_lib",
+    srcs = ["main.go"],
+    importpath = "github.com/gogo/protobuf/protoc-gen-gostring",
+    visibility = ["//visibility:private"],
+    deps = [
+        "//plugin/gostring",
+        "//vanity/command",
+    ],
+)
+
+go_binary(
+    name = "protoc-gen-gostring",
+    embed = [":protoc-gen-gostring_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/protoc-min-version/BUILD.bazel b/protoc-min-version/BUILD.bazel
--- a/protoc-min-version/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/protoc-min-version/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,15 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "protoc-min-version_lib",
+    srcs = ["minversion.go"],
+    importpath = "github.com/gogo/protobuf/protoc-min-version",
+    visibility = ["//visibility:private"],
+    deps = ["//version"],
+)
+
+go_binary(
+    name = "protoc-min-version",
+    embed = [":protoc-min-version_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/sortkeys/BUILD.bazel b/sortkeys/BUILD.bazel
--- a/sortkeys/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/sortkeys/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,14 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "sortkeys",
+    srcs = ["sortkeys.go"],
+    importpath = "github.com/gogo/protobuf/sortkeys",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":sortkeys",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/asymetric-issue125/BUILD.bazel b/test/asymetric-issue125/BUILD.bazel
--- a/test/asymetric-issue125/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/asymetric-issue125/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,33 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["asym.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "asymetric-issue125",
+    srcs = [
+        "asym.pb.go",
+        "pop.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/asymetric-issue125",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":asymetric-issue125",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "asymetric-issue125_test",
+    srcs = ["asym_test.go"],
+    embed = [":asymetric-issue125"],
+)
diff -urN a/test/BUILD.bazel b/test/BUILD.bazel
--- a/test/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,48 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["thetest.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "test",
+    srcs = [
+        "t.go",
+        "thetest.pb.go",
+        "uuid.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/custom",
+        "//test/custom-dash-type",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":test",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "test_test",
+    srcs = [
+        "bug_test.go",
+        "extension_test.go",
+        "thetestpb_test.go",
+        "uuid_test.go",
+    ],
+    embed = [":test"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/cachedsize/BUILD.bazel b/test/cachedsize/BUILD.bazel
--- a/test/cachedsize/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/cachedsize/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["cachedsize.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "cachedsize",
+    srcs = ["cachedsize.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/cachedsize",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":cachedsize",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "cachedsize_test",
+    srcs = ["cachedsize_test.go"],
+    embed = [":cachedsize"],
+    deps = ["//proto"],
+)
diff -urN a/test/casttype/BUILD.bazel b/test/casttype/BUILD.bazel
--- a/test/casttype/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/casttype/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,20 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["casttype.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "casttype",
+    srcs = ["mytypes.go"],
+    importpath = "github.com/gogo/protobuf/test/casttype",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":casttype",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/casttype/combos/both/BUILD.bazel b/test/casttype/combos/both/BUILD.bazel
--- a/test/casttype/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/casttype/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["casttype.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = ["casttype.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/casttype/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/casttype",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = ["casttypepb_test.go"],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/casttype/combos/marshaler/BUILD.bazel b/test/casttype/combos/marshaler/BUILD.bazel
--- a/test/casttype/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/casttype/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["casttype.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = ["casttype.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/casttype/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/casttype",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = ["casttypepb_test.go"],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/casttype/combos/neither/BUILD.bazel b/test/casttype/combos/neither/BUILD.bazel
--- a/test/casttype/combos/neither/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/casttype/combos/neither/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["casttype.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "neither",
+    srcs = ["casttype.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/casttype/combos/neither",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/casttype",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":neither",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "neither_test",
+    srcs = ["casttypepb_test.go"],
+    embed = [":neither"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/casttype/combos/unmarshaler/BUILD.bazel b/test/casttype/combos/unmarshaler/BUILD.bazel
--- a/test/casttype/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/casttype/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["casttype.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = ["casttype.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/casttype/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/casttype",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = ["casttypepb_test.go"],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/castvalue/BUILD.bazel b/test/castvalue/BUILD.bazel
--- a/test/castvalue/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/castvalue/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["castvalue.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "castvalue",
+    srcs = [
+        "castvalue.pb.go",
+        "mytypes.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/castvalue",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":castvalue",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "castvalue_test",
+    srcs = ["castvaluepb_test.go"],
+    embed = [":castvalue"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/castvalue/combos/both/BUILD.bazel b/test/castvalue/combos/both/BUILD.bazel
--- a/test/castvalue/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/castvalue/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["castvalue.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = [
+        "castvalue.pb.go",
+        "mytypes.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/castvalue/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = ["castvaluepb_test.go"],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/castvalue/combos/marshaler/BUILD.bazel b/test/castvalue/combos/marshaler/BUILD.bazel
--- a/test/castvalue/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/castvalue/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["castvalue.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = [
+        "castvalue.pb.go",
+        "mytypes.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/castvalue/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = ["castvaluepb_test.go"],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/castvalue/combos/unmarshaler/BUILD.bazel b/test/castvalue/combos/unmarshaler/BUILD.bazel
--- a/test/castvalue/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/castvalue/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["castvalue.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = [
+        "castvalue.pb.go",
+        "mytypes.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/castvalue/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = ["castvaluepb_test.go"],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/combos/both/BUILD.bazel b/test/combos/both/BUILD.bazel
--- a/test/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,46 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["thetest.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = [
+        "t.go",
+        "thetest.pb.go",
+        "uuid.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/custom",
+        "//test/custom-dash-type",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = [
+        "bug_test.go",
+        "thetestpb_test.go",
+    ],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/combos/marshaler/BUILD.bazel b/test/combos/marshaler/BUILD.bazel
--- a/test/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,46 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["thetest.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = [
+        "t.go",
+        "thetest.pb.go",
+        "uuid.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/custom",
+        "//test/custom-dash-type",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = [
+        "bug_test.go",
+        "thetestpb_test.go",
+    ],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/combos/unmarshaler/BUILD.bazel b/test/combos/unmarshaler/BUILD.bazel
--- a/test/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,46 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["thetest.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = [
+        "t.go",
+        "thetest.pb.go",
+        "uuid.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/custom",
+        "//test/custom-dash-type",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = [
+        "bug_test.go",
+        "thetestpb_test.go",
+    ],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/custom/BUILD.bazel b/test/custom/BUILD.bazel
--- a/test/custom/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/custom/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,20 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "custom",
+    srcs = ["custom.go"],
+    importpath = "github.com/gogo/protobuf/test/custom",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":custom",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "custom_test",
+    srcs = ["custom_test.go"],
+    embed = [":custom"],
+)
diff -urN a/test/custombytesnonstruct/BUILD.bazel b/test/custombytesnonstruct/BUILD.bazel
--- a/test/custombytesnonstruct/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/custombytesnonstruct/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,33 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "custombytesnonstruct",
+    srcs = [
+        "customtype.go",
+        "proto.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/custombytesnonstruct",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":custombytesnonstruct",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "custombytesnonstruct_test",
+    srcs = ["custombytesnonstruct_test.go"],
+    embed = [":custombytesnonstruct"],
+)
diff -urN a/test/custom-dash-type/BUILD.bazel b/test/custom-dash-type/BUILD.bazel
--- a/test/custom-dash-type/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/custom-dash-type/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,14 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "custom-dash-type",
+    srcs = ["customdash.go"],
+    importpath = "github.com/gogo/protobuf/test/custom-dash-type",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":custom-dash-type",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/dashfilename/BUILD.bazel b/test/dashfilename/BUILD.bazel
--- a/test/dashfilename/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/dashfilename/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,26 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["dash-filename.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "dashfilename",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/dashfilename",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":dashfilename",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "dashfilename_test",
+    srcs = ["df_test.go"],
+    embed = [":dashfilename"],
+)
diff -urN a/test/data/BUILD.bazel b/test/data/BUILD.bazel
--- a/test/data/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/data/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["data.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "data",
+    srcs = ["data.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/data",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":data",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "data_test",
+    srcs = ["datapb_test.go"],
+    embed = [":data"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/defaultconflict/BUILD.bazel b/test/defaultconflict/BUILD.bazel
--- a/test/defaultconflict/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/defaultconflict/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,32 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "df.proto",
+        "dg.proto",
+        "nc.proto",
+        "ne.proto",
+        "nx.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "defaultconflict",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/defaultconflict",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":defaultconflict",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "defaultconflict_test",
+    srcs = ["nc_test.go"],
+    embed = [":defaultconflict"],
+)
diff -urN a/test/deterministic/BUILD.bazel b/test/deterministic/BUILD.bazel
--- a/test/deterministic/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/deterministic/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,32 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["deterministic.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "deterministic",
+    srcs = ["deterministic.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/deterministic",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":deterministic",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "deterministic_test",
+    srcs = ["deterministic_test.go"],
+    embed = [":deterministic"],
+    deps = ["//proto"],
+)
diff -urN a/test/embedconflict/BUILD.bazel b/test/embedconflict/BUILD.bazel
--- a/test/embedconflict/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/embedconflict/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,33 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "eb.proto",
+        "ec.proto",
+        "ee.proto",
+        "em.proto",
+        "en.proto",
+        "er.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "embedconflict",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/embedconflict",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":embedconflict",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "embedconflict_test",
+    srcs = ["ec_test.go"],
+    embed = [":embedconflict"],
+)
diff -urN a/test/empty-issue70/BUILD.bazel b/test/empty-issue70/BUILD.bazel
--- a/test/empty-issue70/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/empty-issue70/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,30 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["empty.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "empty-issue70",
+    srcs = ["empty.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/empty-issue70",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":empty-issue70",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "empty-issue70_test",
+    srcs = ["empty_test.go"],
+    embed = [":empty-issue70"],
+)
diff -urN a/test/enumcustomname/BUILD.bazel b/test/enumcustomname/BUILD.bazel
--- a/test/enumcustomname/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/enumcustomname/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["enumcustomname.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "enumcustomname",
+    srcs = ["enumcustomname.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/enumcustomname",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":enumcustomname",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/enumdecl/BUILD.bazel b/test/enumdecl/BUILD.bazel
--- a/test/enumdecl/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/enumdecl/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["enumdecl.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "enumdecl",
+    srcs = [
+        "enumdecl.pb.go",
+        "models.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/enumdecl",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":enumdecl",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "enumdecl_test",
+    srcs = ["enumdeclpb_test.go"],
+    embed = [":enumdecl"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/enumdecl_all/BUILD.bazel b/test/enumdecl_all/BUILD.bazel
--- a/test/enumdecl_all/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/enumdecl_all/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["enumdeclall.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "enumdecl_all",
+    srcs = [
+        "enumdeclall.pb.go",
+        "models.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/enumdecl_all",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":enumdecl_all",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "enumdecl_all_test",
+    srcs = ["enumdeclallpb_test.go"],
+    embed = [":enumdecl_all"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/enumprefix/BUILD.bazel b/test/enumprefix/BUILD.bazel
--- a/test/enumprefix/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/enumprefix/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["enumprefix.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "enumprefix",
+    srcs = ["enumprefix.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/enumprefix",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":enumprefix",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/enumstringer/BUILD.bazel b/test/enumstringer/BUILD.bazel
--- a/test/enumstringer/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/enumstringer/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["enumstringer.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "enumstringer",
+    srcs = [
+        "enumstringer.pb.go",
+        "string.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/enumstringer",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":enumstringer",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "enumstringer_test",
+    srcs = ["enumstringerpb_test.go"],
+    embed = [":enumstringer"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/example/BUILD.bazel b/test/example/BUILD.bazel
--- a/test/example/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/example/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,41 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["example.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "example",
+    srcs = ["example.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/example",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//test",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":example",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "example_test",
+    srcs = [
+        "example_test.go",
+        "examplepb_test.go",
+    ],
+    embed = [":example"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/filedotname/BUILD.bazel b/test/filedotname/BUILD.bazel
--- a/test/filedotname/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/filedotname/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,36 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["file.dot.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "filedotname",
+    srcs = ["file.dot.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/filedotname",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":filedotname",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "filedotname_test",
+    srcs = ["file.dotpb_test.go"],
+    embed = [":filedotname"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/fuzztests/BUILD.bazel b/test/fuzztests/BUILD.bazel
--- a/test/fuzztests/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/fuzztests/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["fuzz.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "fuzztests",
+    srcs = ["fuzz.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/fuzztests",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":fuzztests",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "fuzztests_test",
+    srcs = ["fuzz_test.go"],
+    embed = [":fuzztests"],
+    deps = ["//proto"],
+)
diff -urN a/test/group/BUILD.bazel b/test/group/BUILD.bazel
--- a/test/group/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/group/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,36 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["group.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "group",
+    srcs = ["group.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/group",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":group",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "group_test",
+    srcs = ["grouppb_test.go"],
+    embed = [":group"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/importcustom-issue389/imported/BUILD.bazel b/test/importcustom-issue389/imported/BUILD.bazel
--- a/test/importcustom-issue389/imported/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/importcustom-issue389/imported/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["a.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "imported",
+    srcs = [
+        "a.pb.go",
+        "b.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/importcustom-issue389/imported",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":imported",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "imported_test",
+    srcs = ["apb_test.go"],
+    embed = [":imported"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/importcustom-issue389/importing/BUILD.bazel b/test/importcustom-issue389/importing/BUILD.bazel
--- a/test/importcustom-issue389/importing/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/importcustom-issue389/importing/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,37 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["c.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "importing",
+    srcs = ["c.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/importcustom-issue389/importing",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test/importcustom-issue389/imported",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":importing",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "importing_test",
+    srcs = ["cpb_test.go"],
+    embed = [":importing"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/importcustom-issue389/imported",
+    ],
+)
diff -urN a/test/importdedup/BUILD.bazel b/test/importdedup/BUILD.bazel
--- a/test/importdedup/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/importdedup/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "importdedup",
+    srcs = ["proto.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/importdedup",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test/importdedup/subpkg",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":importdedup",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "importdedup_test",
+    srcs = ["importdedup_test.go"],
+    embed = [":importdedup"],
+)
diff -urN a/test/importdedup/subpkg/BUILD.bazel b/test/importdedup/subpkg/BUILD.bazel
--- a/test/importdedup/subpkg/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/importdedup/subpkg/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,27 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["subproto.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "subpkg",
+    srcs = [
+        "customtype.go",
+        "subproto.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/importdedup/subpkg",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":subpkg",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/importduplicate/BUILD.bazel b/test/importduplicate/BUILD.bazel
--- a/test/importduplicate/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/importduplicate/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,43 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["importduplicate.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "importduplicate",
+    srcs = ["importduplicate.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/importduplicate",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//sortkeys",
+        "//test/importduplicate/proto",
+        "//test/importduplicate/sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":importduplicate",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "importduplicate_test",
+    srcs = [
+        "importduplicate_test.go",
+        "importduplicatepb_test.go",
+    ],
+    embed = [":importduplicate"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/importduplicate/proto",
+        "//test/importduplicate/sortkeys",
+    ],
+)
diff -urN a/test/importduplicate/proto/BUILD.bazel b/test/importduplicate/proto/BUILD.bazel
--- a/test/importduplicate/proto/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/importduplicate/proto/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "proto",
+    srcs = ["proto.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/importduplicate/proto",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":proto",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "proto_test",
+    srcs = ["protopb_test.go"],
+    embed = [":proto"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/importduplicate/sortkeys/BUILD.bazel b/test/importduplicate/sortkeys/BUILD.bazel
--- a/test/importduplicate/sortkeys/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/importduplicate/sortkeys/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["sortable.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "sortkeys",
+    srcs = ["sortable.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/importduplicate/sortkeys",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":sortkeys",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "sortkeys_test",
+    srcs = ["sortablepb_test.go"],
+    embed = [":sortkeys"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/indeximport-issue72/BUILD.bazel b/test/indeximport-issue72/BUILD.bazel
--- a/test/indeximport-issue72/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/indeximport-issue72/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,37 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["indeximport.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "indeximport-issue72",
+    srcs = ["indeximport.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/indeximport-issue72",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test/indeximport-issue72/index",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":indeximport-issue72",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "indeximport-issue72_test",
+    srcs = ["indeximportpb_test.go"],
+    embed = [":indeximport-issue72"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/indeximport-issue72/index",
+    ],
+)
diff -urN a/test/indeximport-issue72/index/BUILD.bazel b/test/indeximport-issue72/index/BUILD.bazel
--- a/test/indeximport-issue72/index/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/indeximport-issue72/index/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["index.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "index",
+    srcs = ["index.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/indeximport-issue72/index",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":index",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "index_test",
+    srcs = ["indexpb_test.go"],
+    embed = [":index"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/int64support/BUILD.bazel b/test/int64support/BUILD.bazel
--- a/test/int64support/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/int64support/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,41 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["object.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "int64support",
+    srcs = [
+        "object.pb.go",
+        "object_js.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/int64support",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":int64support",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "int64support_test",
+    srcs = [
+        "object_js_test.go",
+        "objectpb_test.go",
+    ],
+    embed = [":int64support"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/issue260/BUILD.bazel b/test/issue260/BUILD.bazel
--- a/test/issue260/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue260/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,41 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue260.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue260",
+    srcs = [
+        "issue260.pb.go",
+        "models.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/issue260",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue260",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue260_test",
+    srcs = ["issue260pb_test.go"],
+    embed = [":issue260"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//types",
+    ],
+)
diff -urN a/test/issue261/BUILD.bazel b/test/issue261/BUILD.bazel
--- a/test/issue261/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue261/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,26 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue261.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue261",
+    srcs = ["issue261.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue261",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//sortkeys",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue261",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue262/BUILD.bazel b/test/issue262/BUILD.bazel
--- a/test/issue262/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue262/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["timefail.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue262",
+    srcs = ["timefail.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue262",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue262",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue270/a/BUILD.bazel b/test/issue270/a/BUILD.bazel
--- a/test/issue270/a/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue270/a/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,8 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "a1.proto",
+        "a2.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue270/b/BUILD.bazel b/test/issue270/b/BUILD.bazel
--- a/test/issue270/b/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue270/b/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,5 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["b.proto"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue270/BUILD.bazel b/test/issue270/BUILD.bazel
--- a/test/issue270/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue270/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,20 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "issue270",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/issue270",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue270",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue270_test",
+    srcs = ["issue270_test.go"],
+    embed = [":issue270"],
+)
diff -urN a/test/issue312/BUILD.bazel b/test/issue312/BUILD.bazel
--- a/test/issue312/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue312/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,24 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue312.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue312",
+    srcs = ["issue312.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue312",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue312",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue312/events/BUILD.bazel b/test/issue312/events/BUILD.bazel
--- a/test/issue312/events/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue312/events/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,37 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["events.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "events",
+    srcs = ["events.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue312/events",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test/issue312",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":events",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "events_test",
+    srcs = ["eventspb_test.go"],
+    embed = [":events"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/issue312",
+    ],
+)
diff -urN a/test/issue322/BUILD.bazel b/test/issue322/BUILD.bazel
--- a/test/issue322/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue322/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue322.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue322",
+    srcs = ["issue322.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue322",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue322",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue322_test",
+    srcs = ["issue322pb_test.go"],
+    embed = [":issue322"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/issue330/BUILD.bazel b/test/issue330/BUILD.bazel
--- a/test/issue330/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue330/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue330.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue330",
+    srcs = [
+        "issue330.pb.go",
+        "type.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/issue330",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue330",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue330_test",
+    srcs = ["issue330pb_test.go"],
+    embed = [":issue330"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/issue34/BUILD.bazel b/test/issue34/BUILD.bazel
--- a/test/issue34/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue34/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue34",
+    srcs = ["proto.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue34",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue34",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue34_test",
+    srcs = ["issue34_test.go"],
+    embed = [":issue34"],
+    deps = ["//proto"],
+)
diff -urN a/test/issue411/BUILD.bazel b/test/issue411/BUILD.bazel
--- a/test/issue411/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue411/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,37 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue411.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue411",
+    srcs = [
+        "ids.go",
+        "issue411.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/issue411",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue411",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue411_test",
+    srcs = ["ids_test.go"],
+    deps = [
+        ":issue411",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/issue427/BUILD.bazel b/test/issue427/BUILD.bazel
--- a/test/issue427/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue427/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,5 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue427.proto"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue42order/BUILD.bazel b/test/issue42order/BUILD.bazel
--- a/test/issue42order/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue42order/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue42.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue42order",
+    srcs = ["issue42.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue42order",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue42order",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue42order_test",
+    srcs = ["order_test.go"],
+    embed = [":issue42order"],
+    deps = ["//proto"],
+)
diff -urN a/test/issue435/BUILD.bazel b/test/issue435/BUILD.bazel
--- a/test/issue435/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue435/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue435.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue435",
+    srcs = ["issue435.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue435",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue435",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue435_test",
+    srcs = ["issue435pb_test.go"],
+    embed = [":issue435"],
+    deps = ["//proto"],
+)
diff -urN a/test/issue438/BUILD.bazel b/test/issue438/BUILD.bazel
--- a/test/issue438/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue438/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue438.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue438",
+    srcs = ["issue438.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue438",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue438",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue444/BUILD.bazel b/test/issue444/BUILD.bazel
--- a/test/issue444/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue444/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,30 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue444.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue444",
+    srcs = ["issue444.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue444",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue444",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue444_test",
+    srcs = ["issue444_test.go"],
+    embed = [":issue444"],
+)
diff -urN a/test/issue449/BUILD.bazel b/test/issue449/BUILD.bazel
--- a/test/issue449/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue449/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue449.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue449",
+    srcs = ["issue449.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue449",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue449",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue449_test",
+    srcs = ["issue449_test.go"],
+    embed = [":issue449"],
+    deps = ["//proto"],
+)
diff -urN a/test/issue498/BUILD.bazel b/test/issue498/BUILD.bazel
--- a/test/issue498/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue498/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue498.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue498",
+    srcs = ["issue498.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue498",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue498",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue498_test",
+    srcs = ["issue498pb_test.go"],
+    embed = [":issue498"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/issue503/BUILD.bazel b/test/issue503/BUILD.bazel
--- a/test/issue503/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue503/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue503.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue503",
+    srcs = ["issue503.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue503",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue503",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue503_test",
+    srcs = ["issue503_test.go"],
+    embed = [":issue503"],
+    deps = ["//proto"],
+)
diff -urN a/test/issue530/BUILD.bazel b/test/issue530/BUILD.bazel
--- a/test/issue530/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue530/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,39 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue530.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue530",
+    srcs = ["issue530.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue530",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue530",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue530_test",
+    srcs = [
+        "issue530_test.go",
+        "issue530pb_test.go",
+    ],
+    embed = [":issue530"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/issue617/BUILD.bazel b/test/issue617/BUILD.bazel
--- a/test/issue617/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue617/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,24 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue617.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue617",
+    srcs = ["issue617.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue617",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue617",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/issue620/BUILD.bazel b/test/issue620/BUILD.bazel
--- a/test/issue620/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue620/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue620.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue620",
+    srcs = ["issue620.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue620",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue620",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue620_test",
+    srcs = ["issue620_test.go"],
+    embed = [":issue620"],
+    deps = ["//proto"],
+)
diff -urN a/test/issue630/BUILD.bazel b/test/issue630/BUILD.bazel
--- a/test/issue630/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue630/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,30 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["issue630.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue630",
+    srcs = ["issue630.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue630",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue630",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue630_test",
+    srcs = ["issue630_test.go"],
+    embed = [":issue630"],
+)
diff -urN a/test/issue8/BUILD.bazel b/test/issue8/BUILD.bazel
--- a/test/issue8/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/issue8/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "issue8",
+    srcs = ["proto.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/issue8",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":issue8",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "issue8_test",
+    srcs = ["protopb_test.go"],
+    embed = [":issue8"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/jsonpb-gogo/BUILD.bazel b/test/jsonpb-gogo/BUILD.bazel
--- a/test/jsonpb-gogo/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/jsonpb-gogo/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "jsonpb-gogo",
+    srcs = ["jsonpb_gogo.go"],
+    importpath = "github.com/gogo/protobuf/test/jsonpb-gogo",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":jsonpb-gogo",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "jsonpb-gogo_test",
+    srcs = ["jsonpb_gogo_test.go"],
+    embed = [":jsonpb-gogo"],
+    deps = ["//jsonpb"],
+)
diff -urN a/test/mapdefaults/BUILD.bazel b/test/mapdefaults/BUILD.bazel
--- a/test/mapdefaults/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapdefaults/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,21 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["map.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "mapdefaults",
+    srcs = ["map.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapdefaults",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":mapdefaults",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/mapdefaults/combos/both/BUILD.bazel b/test/mapdefaults/combos/both/BUILD.bazel
--- a/test/mapdefaults/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapdefaults/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,41 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["map.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = ["map.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapdefaults/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = [
+        "map_test.go",
+        "mappb_test.go",
+        "unknown_test.go",
+    ],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/mapdefaults/combos/marshaler/BUILD.bazel b/test/mapdefaults/combos/marshaler/BUILD.bazel
--- a/test/mapdefaults/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapdefaults/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["map.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = ["map.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapdefaults/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = [
+        "map_test.go",
+        "mappb_test.go",
+    ],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/mapdefaults/combos/neither/BUILD.bazel b/test/mapdefaults/combos/neither/BUILD.bazel
--- a/test/mapdefaults/combos/neither/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapdefaults/combos/neither/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["map.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "neither",
+    srcs = ["map.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapdefaults/combos/neither",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":neither",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "neither_test",
+    srcs = [
+        "map_test.go",
+        "mappb_test.go",
+    ],
+    embed = [":neither"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/mapdefaults/combos/unmarshaler/BUILD.bazel b/test/mapdefaults/combos/unmarshaler/BUILD.bazel
--- a/test/mapdefaults/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapdefaults/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,41 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["map.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = ["map.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapdefaults/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = [
+        "map_test.go",
+        "mappb_test.go",
+        "unknown_test.go",
+    ],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/mapsproto2/BUILD.bazel b/test/mapsproto2/BUILD.bazel
--- a/test/mapsproto2/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapsproto2/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,23 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "header.proto",
+        "mapsproto2.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "mapsproto2",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/mapsproto2",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":mapsproto2",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/mapsproto2/combos/both/BUILD.bazel b/test/mapsproto2/combos/both/BUILD.bazel
--- a/test/mapsproto2/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapsproto2/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,42 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["mapsproto2.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = ["mapsproto2.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapsproto2/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = [
+        "mapsproto2_test.go",
+        "mapsproto2pb_test.go",
+    ],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/mapsproto2/combos/marshaler/BUILD.bazel b/test/mapsproto2/combos/marshaler/BUILD.bazel
--- a/test/mapsproto2/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapsproto2/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,42 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["mapsproto2.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = ["mapsproto2.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapsproto2/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = [
+        "mapsproto2_test.go",
+        "mapsproto2pb_test.go",
+    ],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/mapsproto2/combos/neither/BUILD.bazel b/test/mapsproto2/combos/neither/BUILD.bazel
--- a/test/mapsproto2/combos/neither/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapsproto2/combos/neither/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,42 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["mapsproto2.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "neither",
+    srcs = ["mapsproto2.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapsproto2/combos/neither",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":neither",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "neither_test",
+    srcs = [
+        "mapsproto2_test.go",
+        "mapsproto2pb_test.go",
+    ],
+    embed = [":neither"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/mapsproto2/combos/unmarshaler/BUILD.bazel b/test/mapsproto2/combos/unmarshaler/BUILD.bazel
--- a/test/mapsproto2/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mapsproto2/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,42 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["mapsproto2.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = ["mapsproto2.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/mapsproto2/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = [
+        "mapsproto2_test.go",
+        "mapsproto2pb_test.go",
+    ],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/merge/BUILD.bazel b/test/merge/BUILD.bazel
--- a/test/merge/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/merge/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["merge.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "merge",
+    srcs = ["merge.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/merge",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":merge",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "merge_test",
+    srcs = ["merge_test.go"],
+    embed = [":merge"],
+    deps = ["//proto"],
+)
diff -urN a/test/mixbench/BUILD.bazel b/test/mixbench/BUILD.bazel
--- a/test/mixbench/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/mixbench/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,14 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_binary", "go_library")
+
+go_library(
+    name = "mixbench_lib",
+    srcs = ["mixbench.go"],
+    importpath = "github.com/gogo/protobuf/test/mixbench",
+    visibility = ["//visibility:private"],
+)
+
+go_binary(
+    name = "mixbench",
+    embed = [":mixbench_lib"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/moredefaults/BUILD.bazel b/test/moredefaults/BUILD.bazel
--- a/test/moredefaults/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/moredefaults/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["md.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "moredefaults",
+    srcs = ["md.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/moredefaults",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test/example",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":moredefaults",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "moredefaults_test",
+    srcs = [
+        "md_test.go",
+        "mdpb_test.go",
+    ],
+    embed = [":moredefaults"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/example",
+    ],
+)
diff -urN a/test/nopackage/BUILD.bazel b/test/nopackage/BUILD.bazel
--- a/test/nopackage/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/nopackage/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,27 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["nopackage.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "nopackage",
+    srcs = ["nopackage.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/nopackage",
+    visibility = ["//visibility:public"],
+    deps = ["//proto"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":nopackage",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "nopackage_test",
+    srcs = ["nopackage_test.go"],
+    embed = [":nopackage"],
+)
diff -urN a/test/oneof/BUILD.bazel b/test/oneof/BUILD.bazel
--- a/test/oneof/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,20 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "oneof",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":oneof",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/oneof/combos/both/BUILD.bazel b/test/oneof/combos/both/BUILD.bazel
--- a/test/oneof/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//test/casttype",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = ["onepb_test.go"],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneof/combos/marshaler/BUILD.bazel b/test/oneof/combos/marshaler/BUILD.bazel
--- a/test/oneof/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//test/casttype",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = ["onepb_test.go"],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneof/combos/neither/BUILD.bazel b/test/oneof/combos/neither/BUILD.bazel
--- a/test/oneof/combos/neither/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof/combos/neither/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "neither",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof/combos/neither",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//test/casttype",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":neither",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "neither_test",
+    srcs = ["onepb_test.go"],
+    embed = [":neither"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneof/combos/unmarshaler/BUILD.bazel b/test/oneof/combos/unmarshaler/BUILD.bazel
--- a/test/oneof/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//test/casttype",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = ["onepb_test.go"],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneof3/BUILD.bazel b/test/oneof3/BUILD.bazel
--- a/test/oneof3/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof3/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,20 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "oneof3",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof3",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":oneof3",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/oneof3/combos/both/BUILD.bazel b/test/oneof3/combos/both/BUILD.bazel
--- a/test/oneof3/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof3/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,36 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof3/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = ["onepb_test.go"],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneof3/combos/marshaler/BUILD.bazel b/test/oneof3/combos/marshaler/BUILD.bazel
--- a/test/oneof3/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof3/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,36 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof3/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = ["onepb_test.go"],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneof3/combos/neither/BUILD.bazel b/test/oneof3/combos/neither/BUILD.bazel
--- a/test/oneof3/combos/neither/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof3/combos/neither/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,36 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "neither",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof3/combos/neither",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":neither",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "neither_test",
+    srcs = ["onepb_test.go"],
+    embed = [":neither"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneof3/combos/unmarshaler/BUILD.bazel b/test/oneof3/combos/unmarshaler/BUILD.bazel
--- a/test/oneof3/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneof3/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,36 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["one.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = ["one.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneof3/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = ["onepb_test.go"],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/oneofembed/BUILD.bazel b/test/oneofembed/BUILD.bazel
--- a/test/oneofembed/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/oneofembed/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["oneofembed.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "oneofembed",
+    srcs = ["oneofembed.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/oneofembed",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":oneofembed",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "oneofembed_test",
+    srcs = ["oneofembedpb_test.go"],
+    embed = [":oneofembed"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/packed/BUILD.bazel b/test/packed/BUILD.bazel
--- a/test/packed/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/packed/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,34 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["packed.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "packed",
+    srcs = [
+        "doc.go",
+        "packed.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/packed",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":packed",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "packed_test",
+    srcs = ["packed_test.go"],
+    embed = [":packed"],
+    deps = ["//proto"],
+)
diff -urN a/test/proto3extension/BUILD.bazel b/test/proto3extension/BUILD.bazel
--- a/test/proto3extension/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/proto3extension/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,24 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["proto3ext.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "proto3extension",
+    srcs = ["proto3ext.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/proto3extension",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":proto3extension",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/protobuffer/BUILD.bazel b/test/protobuffer/BUILD.bazel
--- a/test/protobuffer/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/protobuffer/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["protobuffer.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "protobuffer",
+    srcs = ["protobuffer.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/protobuffer",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":protobuffer",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "protobuffer_test",
+    srcs = ["protobuffer_test.go"],
+    embed = [":protobuffer"],
+    deps = ["//proto"],
+)
diff -urN a/test/protosize/BUILD.bazel b/test/protosize/BUILD.bazel
--- a/test/protosize/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/protosize/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["protosize.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "protosize",
+    srcs = ["protosize.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/protosize",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":protosize",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "protosize_test",
+    srcs = [
+        "protosize_test.go",
+        "protosizepb_test.go",
+    ],
+    embed = [":protosize"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/registration/BUILD.bazel b/test/registration/BUILD.bazel
--- a/test/registration/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/registration/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,5 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["registration.proto"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/required/BUILD.bazel b/test/required/BUILD.bazel
--- a/test/required/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/required/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,34 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["requiredexample.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "required",
+    srcs = ["requiredexample.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/required",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":required",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "required_test",
+    srcs = ["requiredexamplepb_test.go"],
+    embed = [":required"],
+    deps = [
+        "//proto",
+        "//test",
+    ],
+)
diff -urN a/test/setextensionbytes/BUILD.bazel b/test/setextensionbytes/BUILD.bazel
--- a/test/setextensionbytes/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/setextensionbytes/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,31 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["setextensionbytes.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "setextensionbytes",
+    srcs = ["setextensionbytes.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/setextensionbytes",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":setextensionbytes",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "setextensionbytes_test",
+    srcs = ["setextensionbytes_test.go"],
+    embed = [":setextensionbytes"],
+    deps = ["//proto"],
+)
diff -urN a/test/sizerconflict/BUILD.bazel b/test/sizerconflict/BUILD.bazel
--- a/test/sizerconflict/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/sizerconflict/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,26 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["sizerconflict.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "sizerconflict",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/sizerconflict",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":sizerconflict",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "sizerconflict_test",
+    srcs = ["sizerconflict_test.go"],
+    embed = [":sizerconflict"],
+)
diff -urN a/test/sizeunderscore/BUILD.bazel b/test/sizeunderscore/BUILD.bazel
--- a/test/sizeunderscore/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/sizeunderscore/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["sizeunderscore.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "sizeunderscore",
+    srcs = ["sizeunderscore.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/sizeunderscore",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":sizeunderscore",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "sizeunderscore_test",
+    srcs = ["sizeunderscorepb_test.go"],
+    embed = [":sizeunderscore"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/stdtypes/BUILD.bazel b/test/stdtypes/BUILD.bazel
--- a/test/stdtypes/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/stdtypes/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,41 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["stdtypes.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "stdtypes",
+    srcs = ["stdtypes.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/stdtypes",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//sortkeys",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":stdtypes",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "stdtypes_test",
+    srcs = [
+        "concurrency_test.go",
+        "stdtypespb_test.go",
+    ],
+    embed = [":stdtypes"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//types",
+    ],
+)
diff -urN a/test/tags/BUILD.bazel b/test/tags/BUILD.bazel
--- a/test/tags/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/tags/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,33 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["tags.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "tags",
+    srcs = [
+        "doc.go",
+        "tags.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/tags",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":tags",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "tags_test",
+    srcs = ["tags_test.go"],
+    embed = [":tags"],
+)
diff -urN a/test/theproto3/BUILD.bazel b/test/theproto3/BUILD.bazel
--- a/test/theproto3/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/theproto3/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "footer.proto",
+        "header.proto",
+        "maps.proto",
+        "theproto3.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "theproto3",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/test/theproto3",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":theproto3",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/theproto3/combos/both/BUILD.bazel b/test/theproto3/combos/both/BUILD.bazel
--- a/test/theproto3/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/theproto3/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,43 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["theproto3.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = ["theproto3.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/theproto3/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/combos/both",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = [
+        "proto3_test.go",
+        "theproto3pb_test.go",
+    ],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/combos/both",
+    ],
+)
diff -urN a/test/theproto3/combos/marshaler/BUILD.bazel b/test/theproto3/combos/marshaler/BUILD.bazel
--- a/test/theproto3/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/theproto3/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,43 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["theproto3.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = ["theproto3.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/theproto3/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/combos/both",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = [
+        "proto3_test.go",
+        "theproto3pb_test.go",
+    ],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/combos/both",
+    ],
+)
diff -urN a/test/theproto3/combos/neither/BUILD.bazel b/test/theproto3/combos/neither/BUILD.bazel
--- a/test/theproto3/combos/neither/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/theproto3/combos/neither/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,43 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["theproto3.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "neither",
+    srcs = ["theproto3.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/theproto3/combos/neither",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/combos/both",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":neither",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "neither_test",
+    srcs = [
+        "proto3_test.go",
+        "theproto3pb_test.go",
+    ],
+    embed = [":neither"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/combos/both",
+    ],
+)
diff -urN a/test/theproto3/combos/unmarshaler/BUILD.bazel b/test/theproto3/combos/unmarshaler/BUILD.bazel
--- a/test/theproto3/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/theproto3/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,43 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["theproto3.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = ["theproto3.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/theproto3/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+        "//sortkeys",
+        "//test/combos/both",
+        "//test/custom",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = [
+        "proto3_test.go",
+        "theproto3pb_test.go",
+    ],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//test/combos/both",
+    ],
+)
diff -urN a/test/typedecl/BUILD.bazel b/test/typedecl/BUILD.bazel
--- a/test/typedecl/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/typedecl/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,39 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["typedecl.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "typedecl",
+    srcs = [
+        "models.go",
+        "typedecl.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/typedecl",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":typedecl",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "typedecl_test",
+    srcs = ["typedeclpb_test.go"],
+    embed = [":typedecl"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/typedecl_all/BUILD.bazel b/test/typedecl_all/BUILD.bazel
--- a/test/typedecl_all/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/typedecl_all/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,39 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["typedeclall.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "typedecl_all",
+    srcs = [
+        "models.go",
+        "typedeclall.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/typedecl_all",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":typedecl_all",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "typedecl_all_test",
+    srcs = ["typedeclallpb_test.go"],
+    embed = [":typedecl_all"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/typedeclimport/BUILD.bazel b/test/typedeclimport/BUILD.bazel
--- a/test/typedeclimport/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/typedeclimport/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,34 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["typedeclimport.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "typedeclimport",
+    srcs = [
+        "models.go",
+        "typedeclimport.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/test/typedeclimport",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//test/typedeclimport/subpkg",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":typedeclimport",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "typedeclimport_test",
+    srcs = ["typedeclimport_test.go"],
+    embed = [":typedeclimport"],
+)
diff -urN a/test/typedeclimport/subpkg/BUILD.bazel b/test/typedeclimport/subpkg/BUILD.bazel
--- a/test/typedeclimport/subpkg/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/typedeclimport/subpkg/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,24 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["subpkg.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "subpkg",
+    srcs = ["subpkg.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/typedeclimport/subpkg",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":subpkg",
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/types/BUILD.bazel b/test/types/BUILD.bazel
--- a/test/types/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/types/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,5 @@
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["types.proto"],
+    visibility = ["//visibility:public"],
+)
diff -urN a/test/types/combos/both/BUILD.bazel b/test/types/combos/both/BUILD.bazel
--- a/test/types/combos/both/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/types/combos/both/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["types.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "both",
+    srcs = ["types.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/types/combos/both",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":both",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "both_test",
+    srcs = [
+        "types_test.go",
+        "typespb_test.go",
+    ],
+    embed = [":both"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//types",
+    ],
+)
diff -urN a/test/types/combos/marshaler/BUILD.bazel b/test/types/combos/marshaler/BUILD.bazel
--- a/test/types/combos/marshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/types/combos/marshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["types.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "marshaler",
+    srcs = ["types.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/types/combos/marshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":marshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "marshaler_test",
+    srcs = [
+        "types_test.go",
+        "typespb_test.go",
+    ],
+    embed = [":marshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//types",
+    ],
+)
diff -urN a/test/types/combos/neither/BUILD.bazel b/test/types/combos/neither/BUILD.bazel
--- a/test/types/combos/neither/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/types/combos/neither/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["types.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "neither",
+    srcs = ["types.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/types/combos/neither",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":neither",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "neither_test",
+    srcs = [
+        "types_test.go",
+        "typespb_test.go",
+    ],
+    embed = [":neither"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//types",
+    ],
+)
diff -urN a/test/types/combos/unmarshaler/BUILD.bazel b/test/types/combos/unmarshaler/BUILD.bazel
--- a/test/types/combos/unmarshaler/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/types/combos/unmarshaler/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,40 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["types.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshaler",
+    srcs = ["types.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/types/combos/unmarshaler",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//types",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshaler",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshaler_test",
+    srcs = [
+        "types_test.go",
+        "typespb_test.go",
+    ],
+    embed = [":unmarshaler"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+        "//types",
+    ],
+)
diff -urN a/test/unmarshalmerge/BUILD.bazel b/test/unmarshalmerge/BUILD.bazel
--- a/test/unmarshalmerge/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/unmarshalmerge/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,38 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["unmarshalmerge.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unmarshalmerge",
+    srcs = ["unmarshalmerge.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/unmarshalmerge",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unmarshalmerge",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unmarshalmerge_test",
+    srcs = [
+        "unmarshalmerge_test.go",
+        "unmarshalmergepb_test.go",
+    ],
+    embed = [":unmarshalmerge"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/unrecognized/BUILD.bazel b/test/unrecognized/BUILD.bazel
--- a/test/unrecognized/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/unrecognized/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,39 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["unrecognized.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unrecognized",
+    srcs = ["unrecognized.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/unrecognized",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unrecognized",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unrecognized_test",
+    srcs = [
+        "oldnew_test.go",
+        "unrecognizedpb_test.go",
+    ],
+    embed = [":unrecognized"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/unrecognizedgroup/BUILD.bazel b/test/unrecognizedgroup/BUILD.bazel
--- a/test/unrecognizedgroup/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/unrecognizedgroup/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,39 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["unrecognizedgroup.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "unrecognizedgroup",
+    srcs = ["unrecognizedgroup.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/unrecognizedgroup",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":unrecognizedgroup",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "unrecognizedgroup_test",
+    srcs = [
+        "oldnew_test.go",
+        "unrecognizedgrouppb_test.go",
+    ],
+    embed = [":unrecognizedgroup"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/test/xxxfields/BUILD.bazel b/test/xxxfields/BUILD.bazel
--- a/test/xxxfields/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/test/xxxfields/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = ["xxxfields.proto"],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "xxxfields",
+    srcs = ["xxxfields.pb.go"],
+    importpath = "github.com/gogo/protobuf/test/xxxfields",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":xxxfields",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "xxxfields_test",
+    srcs = ["xxxfieldspb_test.go"],
+    embed = [":xxxfields"],
+    deps = [
+        "//gogoproto",
+        "//jsonpb",
+        "//proto",
+    ],
+)
diff -urN a/types/BUILD.bazel b/types/BUILD.bazel
--- a/types/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/types/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,51 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+go_library(
+    name = "types",
+    srcs = [
+        "any.go",
+        "any.pb.go",
+        "api.pb.go",
+        "doc.go",
+        "duration.go",
+        "duration.pb.go",
+        "duration_gogo.go",
+        "empty.pb.go",
+        "field_mask.pb.go",
+        "protosize.go",
+        "source_context.pb.go",
+        "struct.pb.go",
+        "timestamp.go",
+        "timestamp.pb.go",
+        "timestamp_gogo.go",
+        "type.pb.go",
+        "wrappers.pb.go",
+        "wrappers_gogo.go",
+    ],
+    importpath = "github.com/gogo/protobuf/types",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//proto",
+        "//sortkeys",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":types",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "types_test",
+    srcs = [
+        "any_test.go",
+        "duration_test.go",
+        "timestamp_test.go",
+    ],
+    embed = [":types"],
+    deps = [
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
diff -urN a/vanity/BUILD.bazel b/vanity/BUILD.bazel
--- a/vanity/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/vanity/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,25 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "vanity",
+    srcs = [
+        "enum.go",
+        "field.go",
+        "file.go",
+        "foreach.go",
+        "msg.go",
+    ],
+    importpath = "github.com/gogo/protobuf/vanity",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+        "//protoc-gen-gogo/descriptor",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":vanity",
+    visibility = ["//visibility:public"],
+)
diff -urN a/vanity/command/BUILD.bazel b/vanity/command/BUILD.bazel
--- a/vanity/command/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/vanity/command/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,36 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "command",
+    srcs = ["command.go"],
+    importpath = "github.com/gogo/protobuf/vanity/command",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//plugin/compare",
+        "//plugin/defaultcheck",
+        "//plugin/description",
+        "//plugin/embedcheck",
+        "//plugin/enumstringer",
+        "//plugin/equal",
+        "//plugin/face",
+        "//plugin/gostring",
+        "//plugin/marshalto",
+        "//plugin/oneofcheck",
+        "//plugin/populate",
+        "//plugin/size",
+        "//plugin/stringer",
+        "//plugin/testgen",
+        "//plugin/union",
+        "//plugin/unmarshal",
+        "//proto",
+        "//protoc-gen-gogo/generator",
+        "//protoc-gen-gogo/grpc",
+        "//protoc-gen-gogo/plugin",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":command",
+    visibility = ["//visibility:public"],
+)
diff -urN a/vanity/test/BUILD.bazel b/vanity/test/BUILD.bazel
--- a/vanity/test/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/vanity/test/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,35 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")
+
+filegroup(
+    name = "go_default_library_protos",
+    srcs = [
+        "gogovanity.proto",
+        "proto3.proto",
+        "vanity.proto",
+    ],
+    visibility = ["//visibility:public"],
+)
+
+go_library(
+    name = "test",
+    srcs = ["doc.go"],
+    importpath = "github.com/gogo/protobuf/vanity/test",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":test",
+    visibility = ["//visibility:public"],
+)
+
+go_test(
+    name = "test_test",
+    srcs = ["vanity_test.go"],
+    embed = [":test"],
+    deps = [
+        "//vanity/test/fast",
+        "//vanity/test/faster",
+        "//vanity/test/slick",
+    ],
+)
diff -urN a/vanity/test/fast/BUILD.bazel b/vanity/test/fast/BUILD.bazel
--- a/vanity/test/fast/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/vanity/test/fast/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "fast",
+    srcs = [
+        "gogovanity.pb.go",
+        "proto3.pb.go",
+        "vanity.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/vanity/test/fast",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":fast",
+    visibility = ["//visibility:public"],
+)
diff -urN a/vanity/test/faster/BUILD.bazel b/vanity/test/faster/BUILD.bazel
--- a/vanity/test/faster/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/vanity/test/faster/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "faster",
+    srcs = [
+        "gogovanity.pb.go",
+        "proto3.pb.go",
+        "vanity.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/vanity/test/faster",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":faster",
+    visibility = ["//visibility:public"],
+)
diff -urN a/vanity/test/slick/BUILD.bazel b/vanity/test/slick/BUILD.bazel
--- a/vanity/test/slick/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/vanity/test/slick/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,22 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "slick",
+    srcs = [
+        "gogovanity.pb.go",
+        "proto3.pb.go",
+        "vanity.pb.go",
+    ],
+    importpath = "github.com/gogo/protobuf/vanity/test/slick",
+    visibility = ["//visibility:public"],
+    deps = [
+        "//gogoproto",
+        "//proto",
+    ],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":slick",
+    visibility = ["//visibility:public"],
+)
diff -urN a/version/BUILD.bazel b/version/BUILD.bazel
--- a/version/BUILD.bazel	1970-01-01 00:00:00.000000000 +0000
+++ b/version/BUILD.bazel	2000-01-01 00:00:00.000000000 -0000
@@ -0,0 +1,14 @@
+load("@io_bazel_rules_go//go:def.bzl", "go_library")
+
+go_library(
+    name = "version",
+    srcs = ["version.go"],
+    importpath = "github.com/gogo/protobuf/version",
+    visibility = ["//visibility:public"],
+)
+
+alias(
+    name = "go_default_library",
+    actual = ":version",
+    visibility = ["//visibility:public"],
+)
